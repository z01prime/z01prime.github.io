<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>ICPC2023 HangZhou R 签到+铜牌题 | z01prime</title><meta name="author" content="z01prime"><meta name="copyright" content="z01prime"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="The 2nd Universal Cup. Stage 22: Hangzhou结束了，所以可以把题解扔出来了。 题面：   	      	    V-Diagram长度为 $n$ 的 $1$ -索引整数序列 $a$ 是V-图，如果 $n \ge 3$ 且存在满足以下条件的索引 $i$ （ $1&lt; i &lt; n$ ）：  $a_j &gt; a_{j + 1}$ 用于 $1 \le">
<meta property="og:type" content="article">
<meta property="og:title" content="ICPC2023 HangZhou R 签到+铜牌题">
<meta property="og:url" content="http://example.com/2024/02/15/ICPC2023-HangZhou-R-%E7%AD%BE%E5%88%B0-%E9%93%9C%E7%89%8C%E9%A2%98/index.html">
<meta property="og:site_name" content="z01prime">
<meta property="og:description" content="The 2nd Universal Cup. Stage 22: Hangzhou结束了，所以可以把题解扔出来了。 题面：   	      	    V-Diagram长度为 $n$ 的 $1$ -索引整数序列 $a$ 是V-图，如果 $n \ge 3$ 且存在满足以下条件的索引 $i$ （ $1&lt; i &lt; n$ ）：  $a_j &gt; a_{j + 1}$ 用于 $1 \le">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png">
<meta property="article:published_time" content="2024-02-15T04:00:33.000Z">
<meta property="article:modified_time" content="2024-02-15T05:26:05.438Z">
<meta property="article:author" content="z01prime">
<meta property="article:tag" content="杭州">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2024/02/15/ICPC2023-HangZhou-R-%E7%AD%BE%E5%88%B0-%E9%93%9C%E7%89%8C%E9%A2%98/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":700},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'ICPC2023 HangZhou R 签到+铜牌题',
  isPost: true,
  isHome: false,
  isHighlightShrink: true,
  isToc: true,
  postUpdate: '2024-02-15 13:26:05'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">21</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">11</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 传送门</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://source.fomal.cc/img/dm8.webp')"><nav id="nav"><span id="blog-info"><a href="/" title="z01prime"><span class="site-name">z01prime</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 传送门</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">ICPC2023 HangZhou R 签到+铜牌题</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-02-15T04:00:33.000Z" title="发表于 2024-02-15 12:00:33">2024-02-15</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-02-15T05:26:05.438Z" title="更新于 2024-02-15 13:26:05">2024-02-15</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/ICPC%E5%8C%BA%E5%9F%9F%E8%B5%9B/">ICPC区域赛</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="ICPC2023 HangZhou R 签到+铜牌题"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>The 2nd Universal Cup. Stage 22: Hangzhou结束了，所以可以把题解扔出来了。</p>
<p>题面：</p>


	<div class="row">
    <embed src="statements.pdf" width="100%" height="550" type="application/pdf">
	</div>



<h4 id="V-Diagram"><a href="#V-Diagram" class="headerlink" title="V-Diagram"></a>V-Diagram</h4><p>长度为 $n$ 的 $1$ -索引整数序列 $a$ 是V-图，如果 $n \ge 3$ 且存在满足以下条件的索引 $i$ （ $1&lt; i &lt; n$ ）：</p>
<ul>
<li>$a_j &gt; a_{j + 1}$ 用于 $1 \le j &lt; i$ </li>
<li>$a_j &gt; a_{j - 1}$ 为 $i &lt;j \le n$ 。 </li>
</ul>
<p>给定V-图 $a$ ，找出具有最大可能平均值的V-图 $b$ ，使得 $b$ 是 $a$ 的连续子序列。<br>序列的连续子序列可以通过从序列的开头和结尾移除一些（可能为零）元素来获得。<br>签到题，题解说二分答案也行，但我做的时候用的是贪心。因为对于一个V图来讲，首先一定要包含最小的那个点，然后就是向左右两边扩展取最大。要求在现行复杂度内通过，所以不能直接暴力解，那么观察性质，由于保证是V图所以这个序列对应的图像的每一段的斜率都大于1，换句话说就是i每次改变1（增加一个数），纵坐标ai变化量至少大于1（加上ai），即$\frac{S+a_i}{len+1}$,S表示选中的ai的总和，len表示选的个数，所以不管怎么样选的ai越大越好,并且在选取的时候试单增的，即每多选一个数，对于平均值一定是有贡献的（糖水不等式）。所以假设一开始只有V图的极小值，S = $a_{minn}$,len = 1，要考虑怎么选增幅最大，由于序列a是V图，那么也就是形如8,6,5,3,1,2,4,5,6,7,10这样的，最好的情况一定是包含了10或8，并且在取10或8的时候一定是取了之前的数，那么就要考虑三种情况：选只包含10的最大V图，也就是选3,1,2,4,5,6,7,10；选只包含8的最大V图，也就是8,6,5,3,1,2；全选,8,6,5,3,1,2,4,5,6,7,10。三者取最大即可。<br>记得开long long以及使用cout时设置精度。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 300005</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, a[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	cin &gt;&gt; n;</span><br><span class="line">	<span class="type">int</span> pos, minn = <span class="number">1e9</span> + <span class="number">7</span>, sum = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">		cin &gt;&gt; a[i];</span><br><span class="line">		sum += a[i];</span><br><span class="line">		<span class="keyword">if</span> (minn &gt; a[i]) pos = i, minn = a[i];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">double</span> ans = (<span class="type">double</span>)sum / n;</span><br><span class="line">	sum = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = pos - <span class="number">1</span>; i &lt;= n; ++i) sum += a[i];</span><br><span class="line">	ans = <span class="built_in">max</span>((<span class="type">double</span>)sum / (n - pos + <span class="number">2</span>), ans);</span><br><span class="line">	sum = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= pos + <span class="number">1</span>; ++i) sum += a[i];</span><br><span class="line">	ans = <span class="built_in">max</span>((<span class="type">double</span>)sum / (pos + <span class="number">1</span>), ans);</span><br><span class="line">	cout &lt;&lt; ans &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Mysterious-Tree"><a href="#Mysterious-Tree" class="headerlink" title="Mysterious Tree"></a>Mysterious Tree</h4><p><strong>这是一个交互问题。</strong></p>
<p>Randias有一个具有 $n$ 个顶点的未知隐藏树。树要么是<strong>链</strong>要么是<strong>星</strong>。</p>
<p>兰迪亚斯现在需要确定树是链还是星。他可以提出以下形式的问题，但不得超过 $\lceil \frac{n}{2} \rceil + 3$ 次：</p>
<p>-顶点 $u$ 和顶点 $v$ （ $1 \le u, v \le n$ ， $u \neq v$ ）之间是否有边？</p>
<p>兰迪亚斯需要确定这棵树是两种中的哪一种。帮助他提出问题并确定答案。</p>
<p>一棵树称为<strong>链</strong>，当且仅当存在一个置换 $p_{1}, p_{2}, \ldots, p_{n}$ ，使得对于每个 $i$ （ $1 \le i &lt; n$ ），树中都有一条边 $(p_{i}, p_{i + 1})$ 。</p>
<p>这里，长度为 $n$ 的排列是一个数组，其中从 $1$ 到 $n$ 的每个整数恰好出现一次。一棵树称为<strong>星</strong>当且仅当存在一个顶点 $u$ ，使得每隔一个顶点 $v$ ，树中就有一条边 $(u, v)$ 。</p>
<p>在这个问题中，交互者是<strong>自适应</strong>的，这意味着秘密树不是事先固定的。</p>
<p>相反，交互者可以在交互期间任意改变树。尽管如此，在每一个时刻，这棵树都会与你得到的所有答案保持一致。</p>
<p>注意只能问$\lceil \frac{n}{2} \rceil + 3$次，研究一下链和菊花图的性质，发现菊花图只有一个点是和所有点全部相连，那么首先需要想办法询问到一条存在的边，不妨询问(1, 2),(3, 4),(5, 6), . . . ,(n − 1, n)，这里还要注意如果n是奇数的话还要再问一次(n,1)是不是存在边才能完全保证问完全。如果全都不存在，则必然不是菊花。<br>现在假设存在的边是 (u, v)，我们需要在至多三次询问内确定是链还是菊花。<br>因为我们找到了一条已经确定存在的边，假设这个图是菊花图，那么可以找两个不同的点，设为p1,p2。<br>先问一遍p1和u。<br>如果有，说明如果是菊花图只有u才有可能是菊花中心，再问p2和u，如果也有那么一定是菊花图，如果没有，那么说明只能是链图因为u已经度是2了如果是菊花图u结点是不可能度为2的。<br>如果没有，那只能说明u不可能是菊花图的中心。<br>然后问p1和v，同问p1和u的处理方式判断是菊花图还是链图。这种情况是问的次数最多的，刚好用完。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	cin &gt;&gt; n;</span><br><span class="line">	<span class="type">int</span> u, v;</span><br><span class="line">	<span class="keyword">auto</span> output = [&amp;](<span class="type">int</span> x, <span class="type">int</span> y) -&gt; <span class="type">void</span>&#123;cout &lt;&lt; <span class="string">&quot;? &quot;</span> &lt;&lt; x &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; y &lt;&lt; endl &lt;&lt; endl;&#125;;</span><br><span class="line">	<span class="type">bool</span> flag = <span class="literal">false</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>, input; i &lt;= n; i += <span class="number">2</span>) &#123;</span><br><span class="line">		<span class="built_in">output</span>(i - <span class="number">1</span>, i);</span><br><span class="line">		cin &gt;&gt; input;</span><br><span class="line">		<span class="keyword">if</span> (input) &#123;</span><br><span class="line">			u = i - <span class="number">1</span>, v = i;</span><br><span class="line">			flag = <span class="literal">true</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (n &amp; <span class="number">1</span>) &#123;</span><br><span class="line">		<span class="built_in">output</span>(<span class="number">1</span>, n);</span><br><span class="line">		<span class="type">int</span> input;</span><br><span class="line">		cin &gt;&gt; input;</span><br><span class="line">		<span class="keyword">if</span> (input) &#123;</span><br><span class="line">			u  = <span class="number">1</span>, v = n;</span><br><span class="line">			flag = <span class="literal">true</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (flag) &#123;</span><br><span class="line">		<span class="type">int</span> p1 = <span class="number">0</span>, p2 = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">			<span class="keyword">if</span> (i == u || i == v) <span class="keyword">continue</span>;</span><br><span class="line">			<span class="keyword">if</span> (p1) &#123;</span><br><span class="line">				p2 = i;</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125; <span class="keyword">else</span> p1 = i;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">output</span>(p1, u);</span><br><span class="line">		<span class="type">int</span> st;</span><br><span class="line">		cin &gt;&gt; st;</span><br><span class="line">		<span class="keyword">if</span> (st) &#123;</span><br><span class="line">			<span class="built_in">output</span>(p2, u);</span><br><span class="line">			cin &gt;&gt; st;</span><br><span class="line">			<span class="keyword">if</span> (st) cout &lt;&lt; <span class="string">&quot;! &quot;</span> &lt;&lt; <span class="number">2</span> &lt;&lt; endl &lt;&lt; endl;</span><br><span class="line">			<span class="keyword">else</span> cout &lt;&lt; <span class="string">&quot;! &quot;</span> &lt;&lt; <span class="number">1</span> &lt;&lt; endl &lt;&lt; endl;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="built_in">output</span>(p1, v);</span><br><span class="line">			cin &gt;&gt; st;</span><br><span class="line">			<span class="keyword">if</span> (st) &#123;</span><br><span class="line">				<span class="built_in">output</span>(p2, v);</span><br><span class="line">				cin &gt;&gt; st;</span><br><span class="line">				<span class="keyword">if</span> (st) cout &lt;&lt; <span class="string">&quot;! &quot;</span> &lt;&lt; <span class="number">2</span> &lt;&lt; endl &lt;&lt; endl;</span><br><span class="line">				<span class="keyword">else</span> cout &lt;&lt; <span class="string">&quot;! &quot;</span> &lt;&lt; <span class="number">1</span> &lt;&lt; endl &lt;&lt; endl;</span><br><span class="line">			&#125; <span class="keyword">else</span> cout &lt;&lt; <span class="string">&quot;! &quot;</span> &lt;&lt; <span class="number">1</span> &lt;&lt; endl &lt;&lt; endl;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; <span class="keyword">else</span> cout &lt;&lt; <span class="string">&quot;! &quot;</span> &lt;&lt; <span class="number">1</span> &lt;&lt; endl &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Operator-Precedence"><a href="#Operator-Precedence" class="headerlink" title="Operator Precedence"></a>Operator Precedence</h4><p>构造满足等式$\sum_{i=1}^{n} a_{2 i-1} a_{2 i}=a_{1} a_{2 n} \prod_{i=2}^{n}\left(a_{2 i-2}+a_{2 i-1}\right) \neq 0 .$的序列。<br>被样例误导了，没想明白怎么构造，但是打完表之后就找到了规律，打表代码：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> a[N];</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> n = <span class="number">7</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">check</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="type">int</span> res1 = <span class="number">0</span>,res2 = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>;i&lt;=<span class="number">2</span>*n;i+=<span class="number">2</span>)&#123;</span><br><span class="line">		res1 += a[i]*a[i+<span class="number">1</span>];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">2</span>;i&lt;<span class="number">2</span>*n;i+=<span class="number">2</span>)&#123;<span class="comment">//1 2 3 4 5 6</span></span><br><span class="line">		res2 *= (a[i]+a[i+<span class="number">1</span>]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> res1 == res2;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	a[<span class="number">1</span>] = a[n * <span class="number">2</span>] = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">30</span>; ++i) &#123;</span><br><span class="line">		a[<span class="number">2</span>] = a[<span class="number">2</span> * n - <span class="number">1</span>] = -i;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= <span class="number">30</span>; ++j) &#123;</span><br><span class="line">			a[<span class="number">3</span>] = a[<span class="number">2</span> * n - <span class="number">2</span>] = j;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">1</span>; k &lt;= <span class="number">30</span>; ++k) &#123;</span><br><span class="line">				a[<span class="number">4</span>] = a[<span class="number">2</span> * n - <span class="number">3</span>] = -k;</span><br><span class="line">				<span class="keyword">for</span> (<span class="type">int</span> l = <span class="number">1</span>; l &lt;= <span class="number">30</span>; ++l) &#123;</span><br><span class="line">					a[<span class="number">5</span>] = a[<span class="number">2</span> * n - <span class="number">4</span>] = l;</span><br><span class="line">					<span class="keyword">for</span> (<span class="type">int</span> o = <span class="number">1</span>; o &lt;= <span class="number">30</span>; ++o) &#123;</span><br><span class="line">						a[<span class="number">6</span>] = a[<span class="number">2</span> * n - <span class="number">5</span>] = -o;</span><br><span class="line">						<span class="keyword">for</span> (<span class="type">int</span> p = <span class="number">1</span>; p &lt;= <span class="number">30</span>; ++p) &#123;</span><br><span class="line">							a[<span class="number">7</span>] = a[n * <span class="number">2</span> - <span class="number">6</span>] = p;</span><br><span class="line">							<span class="keyword">if</span>(<span class="built_in">check</span>())&#123;</span><br><span class="line">								<span class="keyword">for</span>(<span class="type">int</span> i1 = <span class="number">1</span>;i1&lt;=<span class="number">2</span>*n;++i1)&#123;</span><br><span class="line">									cout&lt;&lt;a[i1]&lt;&lt;<span class="string">&#x27; &#x27;</span>;</span><br><span class="line">								&#125;</span><br><span class="line">								cout&lt;&lt;endl;</span><br><span class="line">							&#125;</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>n = 7的大概长这样，然后把前几位的拉出来看了下</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">9</span>: <span class="number">1</span> <span class="number">-2</span> <span class="number">1</span> <span class="number">-2</span> <span class="number">1</span> <span class="number">-2</span> <span class="number">1</span> <span class="number">-2</span> <span class="number">5</span> <span class="number">5</span> <span class="number">-2</span> <span class="number">1</span> <span class="number">-2</span> <span class="number">1</span> <span class="number">-2</span> <span class="number">1</span> <span class="number">-2</span> <span class="number">1</span></span><br><span class="line"><span class="number">7</span>: <span class="number">1</span> <span class="number">-2</span> <span class="number">1</span> <span class="number">-2</span> <span class="number">1</span> <span class="number">-2</span> <span class="number">4</span> <span class="number">4</span> <span class="number">-2</span> <span class="number">1</span> <span class="number">-2</span> <span class="number">1</span> <span class="number">-2</span> <span class="number">1</span> </span><br><span class="line"><span class="number">5</span>: <span class="number">1</span> <span class="number">-2</span> <span class="number">1</span> <span class="number">-2</span> <span class="number">3</span> <span class="number">3</span> <span class="number">-2</span> <span class="number">1</span> <span class="number">-2</span> <span class="number">1</span> </span><br><span class="line"><span class="number">3</span>: <span class="number">1</span> <span class="number">-2</span> <span class="number">2</span> <span class="number">2</span> <span class="number">-2</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="number">10</span>: <span class="number">1</span> <span class="number">-1</span> <span class="number">2</span> <span class="number">-1</span> <span class="number">2</span> <span class="number">-1</span> <span class="number">2</span> <span class="number">-1</span> <span class="number">3</span> <span class="number">-7</span> <span class="number">-7</span> <span class="number">3</span> <span class="number">-1</span> <span class="number">2</span> <span class="number">-1</span> <span class="number">2</span> <span class="number">-1</span> <span class="number">2</span> <span class="number">-1</span> <span class="number">1</span></span><br><span class="line"><span class="number">8</span>: <span class="number">1</span> <span class="number">-1</span> <span class="number">2</span> <span class="number">-1</span> <span class="number">2</span> <span class="number">-1</span> <span class="number">3</span> <span class="number">-5</span> <span class="number">-5</span> <span class="number">3</span> <span class="number">-1</span> <span class="number">2</span> <span class="number">-1</span> <span class="number">2</span> <span class="number">-1</span> <span class="number">1</span></span><br><span class="line"><span class="number">6</span>: <span class="number">1</span> <span class="number">-1</span> <span class="number">2</span> <span class="number">-1</span> <span class="number">3</span> <span class="number">-3</span> <span class="number">-3</span> <span class="number">3</span> <span class="number">-1</span> <span class="number">2</span> <span class="number">-1</span> <span class="number">1</span></span><br><span class="line"><span class="number">4</span>: <span class="number">1</span> <span class="number">-1</span> <span class="number">3</span> <span class="number">-1</span> <span class="number">-1</span> <span class="number">3</span> <span class="number">-1</span> <span class="number">1</span> </span><br><span class="line"><span class="number">2</span>: <span class="number">1</span> <span class="number">-1</span> <span class="number">-1</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>然后规律就比较明显了。其实还是复杂了，按照官方题解的构造方法是 考虑到乘法不能乘得太大，那么可以构造类似 x, 2, −1, 2, −1, · · · , 2, −1, y 的序列, 令 y = 1 解出 x 即可。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	cin &gt;&gt; n;</span><br><span class="line">	<span class="keyword">if</span> (n == <span class="number">3</span>)</span><br><span class="line">		<span class="keyword">return</span> cout &lt;&lt; <span class="string">&quot;1 -10 6 6 -10 1&quot;</span> &lt;&lt; endl, <span class="built_in">void</span>();</span><br><span class="line">	cout &lt;&lt; <span class="number">1</span> &lt;&lt; <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= <span class="number">2</span> * n - <span class="number">1</span>; i += <span class="number">2</span>) cout &lt;&lt; <span class="number">2</span> &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; <span class="number">-1</span> &lt;&lt; <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">	cout &lt;&lt; (<span class="number">2</span> - <span class="number">2</span> * (n - <span class="number">2</span>)) / <span class="number">2</span> &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Snake-Move"><a href="#Snake-Move" class="headerlink" title="Snake Move"></a>Snake Move</h4><p>Putata 正在他的笔记本电脑上玩一个著名的蛇形游戏，一条蛇在大小为 $n \times m$ 的网格上移动。网格的某些单元格中可能有障碍物。蛇可以用一串坐标对来表示，这些坐标对决定了蛇身体的位置： $(x_1, y_1), (x_2, y_2), \ldots, (x_k, y_k)$ .这里， $k$ 表示蛇的长度。蛇头位于 $(x_1, y_1)$ ，蛇尾位于 $(x_k, y_k)$ ，蛇身的相邻部分位于共用一条边的单元格中。<br>在这个游戏中，蛇被编程为一系列以字符串表示的命令。您可以使用 5 种命令：</p>
<ul>
<li>‘L’:命令小蛇向左移动一步。蛇头将移动到 $(x_1, y_1 - 1)$ 。</li>
<li>‘R’:命令蛇向右移动一步。蛇头将移动到 $(x_1, y_1 + 1)$ 处。</li>
<li>‘U’:命令蛇向上移动一步。蛇头将移动到 $(x_1 - 1, y_1)$ 处。</li>
<li>‘D’:命令蛇向下移动一步。蛇头将移动到 $(x_1 + 1, y_1)$ 处。</li>
<li>‘S’:将蛇的长度缩短一步。蛇身的尾部将被删除。长度将变为 $k - 1$ 。注意，当 $k = 1$ 时无法执行此操作。</li>
</ul>
<p>当蛇头移动时，蛇身的每个部分也会相应移动。具体来说，身体的第 $i$ 部分（ $2 \leq i \leq k$ ）会移动到 第$(i - 1)$ 部分在命令之前的位置。蛇不能移动到有障碍物的单元格中，也不能移动到网格外。此外，蛇也不能与自己碰撞。因此你应该保证蛇身的任何两个部分都不会共用同一个位置。<br>考虑下面的角情况：蛇头位于 $(x_1, y_1)$ ，蛇尾位于 $(x_k, y_k)$ 。如果头部移动到 $(x_1’, y_1’)$ ，那么就<strong>允许</strong>移动到 $(x_1’, y_1’) = (x_k, y_k)$ ：如果我们考虑现实世界中的情况，头部移动到单元格时，尾部正好移动到单元格外。类似地，在 $k = 2$ 处使用一条命令就可以交换头部和尾部。<br>您将得到网格的地图和蛇的身体序列。让 $f(i, j)$ 表示普塔塔为使蛇头到达 $(i, j)$ 所需的最少指令数，如果不可能，则为 $0$ 。你必须计算<br>$\left(\sum_{i = 1}^n\sum_{j = 1}^m f(i, j)^2\right) \bmod 2^{64}\text{.}$</p>
<p>输入</p>
<p>输入的第一行包含三个整数 $n$ 、 $m$ 和 $k$ （ $1 \leq n, m \leq 3000$ 、 $1 \leq k \leq \min\{nm, 10^5\}$ ），分别表示网格的大小和蛇的长度。</p>
<p>在接下来的 $k$ 行中， $i$ /th行包含两个整数 $x_i$ 和 $y_i$ （ $1 \leq x_i \leq n$ , $1 \leq y_i \leq m$ , $|x_i - x_{i+1}| + |y_i - y_{i+1}| = 1$ ），分别表示蛇身 $i$ /th部分的位置。保证所有 $k$ 对 $(x_i, y_i)$ 都是成对不同的。同时保证每个部分都位于一个没有障碍物的单元格中。</p>
<p>在接下来的 $n$ 行中， $i$ /th行包含一个长度为 $m$ 的字符串。如果 $(i, j)$ 单元格为空，那么这些行中 $i$ /th的 $j$ 个字符就是”.”。如果单元格 $(i, j)$ 被障碍物占据，则该字符为 “#”。<br>输出</p>
<p>打印一行，其中包含一个整数：问题答案。</p>
<p>嘴硬一下其实不是很难。<br>一开始没想明白是怎么回事，以为是走完全部的能到达的格子之后再计算$\left(\sum_{i = 1}^n\sum_{j = 1}^m f(i, j)^2\right) \bmod 2^{64}\text{.}$实际上是问你从起点开始走到(i,j)要多少步，那么就很套路的网格图建图求最短单源路径。<br>可以用dij，有一个比较难处理的地方是如果当前格子上有蛇的身体占着那么想要移动到这个格子就必须要等蛇身移走。<br>由于每个操作都可以等价看作初始蛇身必然缩短 1，并且同时控制蛇头移动一步或者不移动。<br>所以等蛇身移走就等于当前这个位置必须操作 k − i 次后才能访问该点。<br>这样的话就要先记录初始状态下第 i (2 ≤ i ≤ k) 节蛇身所处的位置，这里用map储存。<br>如果当前队列的队头移动到是蛇身，那么需要将队头所在位置的最短路长度与k − i 取最大值，然后再+1表示从队头所在位移动到蛇身的位置，松弛蛇身的位置的最短路。<br>如果当前队列的队头移动到的不是蛇身，那就直接普通的dij松弛即可。<br>但是注意题目的范围可以发现实际上堆优化的dij过不了，多带了一个log，这里用到了一个小trick：对于边长度固定的图（如等于1），那么BFS找到的从起点结点到任意节点的路径都是最短路。那么其实就可以直接用队列代替优先队列加速。<br>然后发现如果只用一个队列储存状态会有问题，因为这个边长并不全是1，因为蛇身有一个取max的操作。也就是说从不同情况下（蛇身位置与非蛇身位置）走到蛇身位置无法保证先进队列的一定就是最短路径。<br>实现的时候可以这样处理：一个队列存不是蛇身的位置，另一个存是蛇身的位置，每次先比较两个队列的队首，谁小就优先出队处理，这样就能保证队列的贪心是正确的。<br>题目中不太能理解的是取模和平方，取模的问题，其实C++没有哪一个类型能表示2的64次方(当然什么__int128就不算了)，合理怀疑是不需要取模的，取最坏的大概估算一下发现根本到不了2的64次方。对最短路平方还想了好久是不是有什么几何意义。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int unsigned long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 3005</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> dist[N][N], m, n, k;</span><br><span class="line">map&lt;array&lt;<span class="type">int</span>, 2&gt;, <span class="type">int</span>&gt; isBody;</span><br><span class="line"></span><br><span class="line">vector&lt;array&lt;<span class="type">signed</span>, 2&gt;&gt; d&#123;&#123;<span class="number">1</span>,  <span class="number">0</span>&#125;,&#123;<span class="number">-1</span>, <span class="number">0</span>&#125;,&#123;<span class="number">0</span>,  <span class="number">1</span>&#125;,&#123;<span class="number">0</span>,  <span class="number">-1</span>&#125;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">//    auto debugSt = [&amp;]() -&gt; void &#123;for (int i = 1; i &lt;= n; ++i) for (int j = 1; j &lt;= m; ++j) cout &lt;&lt; st[i][j] &lt;&lt; &quot; \n&quot;[j == m];&#125;;</span></span><br><span class="line"><span class="comment">//    auto debugDist = [&amp;]() -&gt; void &#123;for (int i = 1; i &lt;= n; ++i) for (int j = 1; j &lt;= m; ++j) cout &lt;&lt; dist[i][j] &lt;&lt; &quot; \n&quot;[j == m];&#125;;</span></span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m &gt;&gt; k;</span><br><span class="line">    <span class="type">int</span> headX, headY;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= k; ++i) &#123;</span><br><span class="line">        <span class="type">int</span> x, y;</span><br><span class="line">        cin &gt;&gt; x &gt;&gt; y;</span><br><span class="line">        <span class="keyword">if</span> (i == <span class="number">1</span>) headX = x, headY = y;</span><br><span class="line">        isBody[array&lt;<span class="type">int</span>, 2&gt;&#123;x, y&#125;] = i;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= m; ++j) &#123;</span><br><span class="line">            <span class="type">char</span> c;</span><br><span class="line">            cin &gt;&gt; c;</span><br><span class="line">            <span class="keyword">if</span> (c == <span class="string">&#x27;.&#x27;</span>) dist[i][j] = <span class="number">1ll</span> &lt;&lt; <span class="number">62</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    queue&lt;array&lt;<span class="type">int</span>, 2&gt;&gt; body, q;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> judge = [&amp;](<span class="type">int</span> x, <span class="type">int</span> y) -&gt; <span class="type">bool</span> &#123; <span class="keyword">return</span> isBody.<span class="built_in">count</span>(array&lt;<span class="type">int</span>, <span class="number">2</span>&gt;&#123;x, y&#125;); &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> bfs = [&amp;](<span class="type">int</span> x, <span class="type">int</span> y) -&gt; <span class="type">void</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> [dx, dy]: d) &#123;</span><br><span class="line">            <span class="type">int</span> w = dist[x][y];</span><br><span class="line">            <span class="type">int</span> _x = x + dx, _y = y + dy;</span><br><span class="line">            <span class="keyword">if</span> (_x &lt; <span class="number">1</span> || _x &gt; n || _y &lt; <span class="number">1</span> || _y &gt; m) <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">judge</span>(_x, _y)) &#123;</span><br><span class="line">                w = <span class="built_in">max</span>(w, k - isBody[array&lt;<span class="type">int</span>, <span class="number">2</span>&gt;&#123;_x, _y&#125;]);</span><br><span class="line">                <span class="keyword">if</span> (w + <span class="number">1</span> &lt; dist[_x][_y]) &#123;</span><br><span class="line">                    dist[_x][_y] = w + <span class="number">1</span>;</span><br><span class="line">                    body.<span class="built_in">push</span>(array&lt;<span class="type">int</span>, <span class="number">2</span>&gt;&#123;_x, _y&#125;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (w + <span class="number">1</span> &lt; dist[_x][_y]) &#123;</span><br><span class="line">                    dist[_x][_y] = w + <span class="number">1</span>;</span><br><span class="line">                    q.<span class="built_in">push</span>(array&lt;<span class="type">int</span>, <span class="number">2</span>&gt;&#123;_x, _y&#125;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    body.<span class="built_in">push</span>(array&lt;<span class="type">int</span>, <span class="number">2</span>&gt;&#123;headX, headY&#125;);</span><br><span class="line">    dist[headX][headY] = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (!body.<span class="built_in">empty</span>() || !q.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!body.<span class="built_in">empty</span>() &amp;&amp; !q.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="keyword">auto</span> [qx, qy] = q.<span class="built_in">front</span>();</span><br><span class="line">            <span class="keyword">auto</span> [bx, by] = body.<span class="built_in">front</span>();</span><br><span class="line">            <span class="keyword">if</span> (dist[qx][qy] &lt; dist[bx][by]) &#123;</span><br><span class="line">                q.<span class="built_in">pop</span>();</span><br><span class="line">                <span class="type">int</span> x = qx, y = qy;</span><br><span class="line">                <span class="built_in">bfs</span>(x, y);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                body.<span class="built_in">pop</span>();</span><br><span class="line">                <span class="type">int</span> x = bx, y = by;</span><br><span class="line">                <span class="built_in">bfs</span>(x, y);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!body.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="keyword">auto</span> [bx, by] = body.<span class="built_in">front</span>();</span><br><span class="line">            body.<span class="built_in">pop</span>();</span><br><span class="line">            <span class="type">int</span> x = bx, y = by;</span><br><span class="line">            <span class="built_in">bfs</span>(x, y);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!q.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="keyword">auto</span> [qx, qy] = q.<span class="built_in">front</span>();</span><br><span class="line">            q.<span class="built_in">pop</span>();</span><br><span class="line">            <span class="type">int</span> x = qx, y = qy;</span><br><span class="line">            <span class="built_in">bfs</span>(x, y);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= m; ++j)</span><br><span class="line">            ans += dist[i][j] * dist[i][j];</span><br><span class="line">    cout &lt;&lt; ans &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>有个小细节就是dist取1&lt;&lt;62就能保证如果这个点到达不了那么在第87行就不需要判断<code>dist[i][j]&lt;(1&lt;&lt;62)</code>因为相乘之后一定是溢出的，最后会被直接截断成0。<br><del>堆优化过不了但可能直接跑朴素dij能过没试过不知道行不行。</del></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://example.com">z01prime</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a target="_blank" rel="noopener" href="http://z01prime.github.io/2024/02/15/ICPC2023-HangZhou-R-签到-铜牌题/">http://z01prime.github.io/2024/02/15/ICPC2023-HangZhou-R-签到-铜牌题/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">z01prime</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%9D%AD%E5%B7%9E/">杭州</a></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/03/04/%E3%80%90LGR-174-Div-2%E3%80%91T2%E3%80%81T3/" title="【LGR-174-Div.2】T2、T3"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">【LGR-174-Div.2】T2、T3</div></div></a></div><div class="next-post pull-right"><a href="/2024/02/13/01%E5%AD%97%E5%85%B8%E6%A0%91/" title="01字典树"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">01字典树</div></div></a></div></nav><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="gitalk-container"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">z01prime</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">21</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">11</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/z01prime"><i class="fab fa-github"></i><span>我的github主页</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/z01prime" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:z7296091@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">加载慢可以挂个梯子试试捏</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#V-Diagram"><span class="toc-number">1.</span> <span class="toc-text">V-Diagram</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Mysterious-Tree"><span class="toc-number">2.</span> <span class="toc-text">Mysterious Tree</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Operator-Precedence"><span class="toc-number">3.</span> <span class="toc-text">Operator Precedence</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Snake-Move"><span class="toc-number">4.</span> <span class="toc-text">Snake Move</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/03/16/%E6%95%B4%E9%99%A4%E5%88%86%E5%9D%97/" title="整除分块">整除分块</a><time datetime="2024-03-16T07:43:27.000Z" title="发表于 2024-03-16 15:43:27">2024-03-16</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/03/16/13thSDCPC/" title="13thSDCPC">13thSDCPC</a><time datetime="2024-03-16T02:40:23.000Z" title="发表于 2024-03-16 10:40:23">2024-03-16</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/03/04/%E3%80%90LGR-174-Div-2%E3%80%91T2%E3%80%81T3/" title="【LGR-174-Div.2】T2、T3">【LGR-174-Div.2】T2、T3</a><time datetime="2024-03-04T14:37:46.000Z" title="发表于 2024-03-04 22:37:46">2024-03-04</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/02/15/ICPC2023-HangZhou-R-%E7%AD%BE%E5%88%B0-%E9%93%9C%E7%89%8C%E9%A2%98/" title="ICPC2023 HangZhou R 签到+铜牌题">ICPC2023 HangZhou R 签到+铜牌题</a><time datetime="2024-02-15T04:00:33.000Z" title="发表于 2024-02-15 12:00:33">2024-02-15</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/02/13/01%E5%AD%97%E5%85%B8%E6%A0%91/" title="01字典树">01字典树</a><time datetime="2024-02-13T03:54:17.000Z" title="发表于 2024-02-13 11:54:17">2024-02-13</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://source.fomal.cc/img/dm8.webp')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By z01prime</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      tags: 'ams'
    },
    chtml: {
      scale: 1.1
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, '']
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typesetPromise()
}</script><script>function loadGitalk () {
  function initGitalk () {
    var gitalk = new Gitalk(Object.assign({
      clientID: 'e8f61b4db601b696558e',
      clientSecret: '2f5cacaf3b111d5db02b1b40be93f02553bf9aa4',
      repo: 'commetForGitalk',
      owner: 'z01prime',
      admin: ['z01prime'],
      id: '02d79e62b01c143ca3609c3376bd5107',
      updateCountCallback: commentCount
    },null))

    gitalk.render('gitalk-container')
  }

  if (typeof Gitalk === 'function') initGitalk()
  else {
    getCSS('https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css')
    getScript('https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.js').then(initGitalk)
  }
}

function commentCount(n){
  let isCommentCount = document.querySelector('#post-meta .gitalk-comment-count')
  if (isCommentCount) {
    isCommentCount.textContent= n
  }
}

if ('Gitalk' === 'Gitalk' || !true) {
  if (true) btf.loadComment(document.getElementById('gitalk-container'), loadGitalk)
  else loadGitalk()
} else {
  function loadOtherComment () {
    loadGitalk()
  }
}</script></div><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="25" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div class="no-result" id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>